## คำถามทบทวน

### 1. Software Timer คืออะไร และแตกต่างจาก Hardware Timer อย่างไร?

*   **Software Timer:** เป็นฟังก์ชันจับเวลาที่จำลองขึ้นโดย FreeRTOS kernel เอง Timer ทุกตัวจะถูกจัดการโดย Task กลางของระบบที่ชื่อว่า **Timer Service Task** มีข้อดีคือสามารถสร้างจำนวน Timer ได้มากเท่าที่ต้องการโดยใช้ทรัพยากรอย่างมีประสิทธิภาพ (ไม่ต้องสร้าง Task ใหม่สำหรับทุก Timer) แต่ข้อเสียคือมีความแม่นยำไม่สูงมากนัก ขึ้นอยู่กับความถี่ของ System Tick (`configTICK_RATE_HZ`) และ Priority ของ Timer Service Task

*   **Hardware Timer:** เป็นวงจรอิเล็กทรอนิกส์ (Peripheral) ที่มีอยู่จริงบนชิปไมโครคอนโทรลเลอร์ มีความแม่นยำสูงมากและทำงานเป็นอิสระจากภาระงานของ CPU แต่มีจำนวนจำกัด เหมาะสำหรับงานที่ต้องการความเที่ยงตรงของเวลาสูง เช่น การสร้างสัญญาณ PWM หรือการวัดคาบเวลาที่แม่นยำ

### 2. One-shot timer กับ Auto-reload timer ต่างกันอย่างไร?

*   **One-shot Timer:** จะทำงาน (เรียก Callback Function) **เพียงครั้งเดียว** เมื่อครบกำหนดเวลาแล้วจะหยุดทำงาน (เข้าสู่สถานะ Dormant) ทันที เหมาะสำหรับงานที่ต้องการหน่วงเวลาเพื่อทำอะไรบางอย่าง เช่น การทำ Timeout หรือการสั่งทำงานที่ล่าช้าออกไป (Delayed Action) ในการสร้างจะกำหนดพารามิเตอร์ `uxAutoReload` เป็น `pdFALSE`

*   **Auto-reload Timer (Periodic Timer):** จะทำงาน **ซ้ำๆ ไปเรื่อยๆ** ตามคาบเวลาที่กำหนด เมื่อทำงานเสร็จในแต่ละรอบ มันจะตั้งเวลาใหม่และเริ่มนับถอยหลังต่อโดยอัตโนมัติ เหมาะสำหรับงานที่ต้องทำเป็นประจำ เช่น การอ่านค่าเซ็นเซอร์ทุกๆ 1 วินาที หรือการส่งสัญญาณ Heartbeat ในการสร้างจะกำหนด `uxAutoReload` เป็น `pdTRUE`

### 3. Timer Callback Function คืออะไร และมีข้อจำกัดอะไรบ้าง?

*   **Timer Callback Function** คือฟังก์ชันที่ Timer Service Task จะเรียกให้ทำงานเมื่อ Software Timer ที่เราสร้างไว้หมดเวลาลง

*   **ข้อจำกัดที่สำคัญมาก:**
    1.  **ต้องสั้นและห้าม Block:** Callback ของทุก Timer จะถูกเรียกทำงานใน Context ของ Timer Service Task ตัวเดียวกัน หากมี Callback ใดทำงานนานหรือเกิดการ Block (เช่น การเรียก `vTaskDelay`) จะไปขัดขวางการทำงานของ Software Timer อื่นๆ ทั้งหมดในระบบ
    2.  **ควรใช้ API เวอร์ชัน ISR:** หากจำเป็นต้องเรียกใช้ FreeRTOS API จากใน Callback (เช่น การส่งข้อมูลเข้า Queue หรือการ Give Semaphore) ควรใช้ฟังก์ชันเวอร์ชันที่ลงท้ายด้วย `...FromISR()` (เช่น `xQueueSendFromISR()`) เพราะมีความปลอดภัย (Thread-safe) ในการเรียกจาก Callback มากกว่า

### 4. Software Timers ถูกจัดการโดย Task อะไร?

*   Software Timer ทั้งหมดในระบบจะถูกจัดการโดย Task พิเศษของ FreeRTOS เพียงตัวเดียวที่ชื่อว่า **Timer Service Task** (บางครั้งเรียกว่า Timer Daemon) Task นี้จะถูกสร้างขึ้นโดยอัตโนมัติเมื่อ Scheduler เริ่มทำงาน (หาก `configUSE_TIMERS` ถูกตั้งเป็น 1) Task ของผู้ใช้ไม่ได้ควบคุม Timer โดยตรง แต่จะส่ง "คำสั่ง" (เช่น start, stop, reset) ไปยัง Timer Service Task ผ่านทาง Command Queue จากนั้น Timer Service Task จะเป็นผู้ประมวลผลคำสั่งและเรียกใช้ Callback ให้เมื่อถึงเวลาที่กำหนด